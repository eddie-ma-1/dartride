dist = {}
for loc in [[-72.296229,43.704232],[-72.296556,43.703862],[-72.291625,43.705083],[-72.290783,43.705108],[-72.288669,43.704155],[-72.284297,43.704408],[-72.284316,43.703385],[-72.286908,43.702722],[-72.293010,43.706285]]:
    dist[str(loc)] = {}

dist[str([-72.296229, 43.704232])][str([-72.296229, 43.704232])] = 0
dist[str([-72.296229, 43.704232])][str([-72.296556, 43.703862])] = 15.5
dist[str([-72.296229, 43.704232])][str([-72.291625, 43.705083])] = 125.7
dist[str([-72.296229, 43.704232])][str([-72.290783, 43.705108])] = 138.5
dist[str([-72.296229, 43.704232])][str([-72.288669, 43.704155])] = 316.6
dist[str([-72.296229, 43.704232])][str([-72.284297, 43.704408])] = 361.7
dist[str([-72.296229, 43.704232])][str([-72.284316, 43.703385])] = 311.7
dist[str([-72.296229, 43.704232])][str([-72.286908, 43.702722])] = 284
dist[str([-72.296229, 43.704232])][str([-72.29301, 43.706285])] = 222.3
dist[str([-72.296556, 43.703862])][str([-72.296229, 43.704232])] = 19.1
dist[str([-72.296556, 43.703862])][str([-72.296556, 43.703862])] = 0
dist[str([-72.296556, 43.703862])][str([-72.291625, 43.705083])] = 125.5
dist[str([-72.296556, 43.703862])][str([-72.290783, 43.705108])] = 138.3
dist[str([-72.296556, 43.703862])][str([-72.288669, 43.704155])] = 316.4
dist[str([-72.296556, 43.703862])][str([-72.284297, 43.704408])] = 361.5
dist[str([-72.296556, 43.703862])][str([-72.284316, 43.703385])] = 311.5
dist[str([-72.296556, 43.703862])][str([-72.286908, 43.702722])] = 283.8
dist[str([-72.296556, 43.703862])][str([-72.29301, 43.706285])] = 222.1
dist[str([-72.291625, 43.705083])][str([-72.296229, 43.704232])] = 119.9
dist[str([-72.291625, 43.705083])][str([-72.296556, 43.703862])] = 118.3
dist[str([-72.291625, 43.705083])][str([-72.291625, 43.705083])] = 0
dist[str([-72.291625, 43.705083])][str([-72.290783, 43.705108])] = 12.8
dist[str([-72.291625, 43.705083])][str([-72.288669, 43.704155])] = 190.9
dist[str([-72.291625, 43.705083])][str([-72.284297, 43.704408])] = 236
dist[str([-72.291625, 43.705083])][str([-72.284316, 43.703385])] = 186
dist[str([-72.291625, 43.705083])][str([-72.286908, 43.702722])] = 158.3
dist[str([-72.291625, 43.705083])][str([-72.29301, 43.706285])] = 96.6
dist[str([-72.290783, 43.705108])][str([-72.296229, 43.704232])] = 132.1
dist[str([-72.290783, 43.705108])][str([-72.296556, 43.703862])] = 130.5
dist[str([-72.290783, 43.705108])][str([-72.291625, 43.705083])] = 12.2
dist[str([-72.290783, 43.705108])][str([-72.290783, 43.705108])] = 0
dist[str([-72.290783, 43.705108])][str([-72.288669, 43.704155])] = 178.1
dist[str([-72.290783, 43.705108])][str([-72.284297, 43.704408])] = 223.2
dist[str([-72.290783, 43.705108])][str([-72.284316, 43.703385])] = 173.2
dist[str([-72.290783, 43.705108])][str([-72.286908, 43.702722])] = 145.5
dist[str([-72.290783, 43.705108])][str([-72.29301, 43.706285])] = 83.8
dist[str([-72.288669, 43.704155])][str([-72.296229, 43.704232])] = 197.5
dist[str([-72.288669, 43.704155])][str([-72.296556, 43.703862])] = 195.9
dist[str([-72.288669, 43.704155])][str([-72.291625, 43.705083])] = 77.6
dist[str([-72.288669, 43.704155])][str([-72.290783, 43.705108])] = 65.4
dist[str([-72.288669, 43.704155])][str([-72.288669, 43.704155])] = 0
dist[str([-72.288669, 43.704155])][str([-72.284297, 43.704408])] = 194.4
dist[str([-72.288669, 43.704155])][str([-72.284316, 43.703385])] = 144.4
dist[str([-72.288669, 43.704155])][str([-72.286908, 43.702722])] = 116.7
dist[str([-72.288669, 43.704155])][str([-72.29301, 43.706285])] = 93.5
dist[str([-72.284297, 43.704408])][str([-72.296229, 43.704232])] = 401
dist[str([-72.284297, 43.704408])][str([-72.296556, 43.703862])] = 399.4
dist[str([-72.284297, 43.704408])][str([-72.291625, 43.705083])] = 289.4
dist[str([-72.284297, 43.704408])][str([-72.290783, 43.705108])] = 212.9
dist[str([-72.284297, 43.704408])][str([-72.288669, 43.704155])] = 147.5
dist[str([-72.284297, 43.704408])][str([-72.284297, 43.704408])] = 0
dist[str([-72.284297, 43.704408])][str([-72.284316, 43.703385])] = 95.9
dist[str([-72.284297, 43.704408])][str([-72.286908, 43.702722])] = 88.5
dist[str([-72.284297, 43.704408])][str([-72.29301, 43.706285])] = 241
dist[str([-72.284316, 43.703385])][str([-72.296229, 43.704232])] = 339.5
dist[str([-72.284316, 43.703385])][str([-72.296556, 43.703862])] = 337.9
dist[str([-72.284316, 43.703385])][str([-72.291625, 43.705083])] = 227.9
dist[str([-72.284316, 43.703385])][str([-72.290783, 43.705108])] = 151.4
dist[str([-72.284316, 43.703385])][str([-72.288669, 43.704155])] = 86
dist[str([-72.284316, 43.703385])][str([-72.284297, 43.704408])] = 78.2
dist[str([-72.284316, 43.703385])][str([-72.284316, 43.703385])] = 0
dist[str([-72.284316, 43.703385])][str([-72.286908, 43.702722])] = 27
dist[str([-72.284316, 43.703385])][str([-72.29301, 43.706285])] = 179.5
dist[str([-72.286908, 43.702722])][str([-72.296229, 43.704232])] = 312.5
dist[str([-72.286908, 43.702722])][str([-72.296556, 43.703862])] = 310.9
dist[str([-72.286908, 43.702722])][str([-72.291625, 43.705083])] = 200.9
dist[str([-72.286908, 43.702722])][str([-72.290783, 43.705108])] = 124.4
dist[str([-72.286908, 43.702722])][str([-72.288669, 43.704155])] = 59
dist[str([-72.286908, 43.702722])][str([-72.284297, 43.704408])] = 77.7
dist[str([-72.286908, 43.702722])][str([-72.284316, 43.703385])] = 27.7
dist[str([-72.286908, 43.702722])][str([-72.286908, 43.702722])] = 0
dist[str([-72.286908, 43.702722])][str([-72.29301, 43.706285])] = 152.5
dist[str([-72.29301, 43.706285])][str([-72.296229, 43.704232])] = 212.4
dist[str([-72.29301, 43.706285])][str([-72.296556, 43.703862])] = 210.8
dist[str([-72.29301, 43.706285])][str([-72.291625, 43.705083])] = 92.5
dist[str([-72.29301, 43.706285])][str([-72.290783, 43.705108])] = 80.3
dist[str([-72.29301, 43.706285])][str([-72.288669, 43.704155])] = 187.4
dist[str([-72.29301, 43.706285])][str([-72.284297, 43.704408])] = 253.6
dist[str([-72.29301, 43.706285])][str([-72.284316, 43.703385])] = 203.6
dist[str([-72.29301, 43.706285])][str([-72.286908, 43.702722])] = 175.9
dist[str([-72.29301, 43.706285])][str([-72.29301, 43.706285])] = 0

mappings = {"Judge Hall":[-72.296229,43.704232],
    "French Hall":[-72.296556,43.703862],
    "Fahey McLane":[-72.291625,43.705083],
    "Russell Sage":[-72.290783,43.705108],
    "Baker Library":[-72.288669,43.704155],
    "Zimmerman Hall":[-72.284297,43.704408],
    "Alumni Gymnasium":[-72.284316,43.703385],
    "New Hamp":[-72.286908,43.702722],
    "Phil Hanlons Lawn":[-72.293010,43.706285]}

import json
from driver import Driver
from ride_request import Ride_Request

def BetterEngine(drivers, riders):
    minTime = 1000000 #minimum time across all calls
    minStart = -1  #where to put the start in the list
    minStop = -1   #where to put the stop in the list
    driver = drivers[0] #which driver corresponds to min driver
    minRide = None
    for ride in riders:
        for x in drivers:
            if(len(x.route)==0):
                return 0, driver, minStart, minStop, ride
            currentRiders = x.num_riders #how many riders are currently in the car
            for i in range(0,len(x.route)): #i is the index in the driver queue that you insert the new start point after
                if(x.route[i][2]):    #if the type is start then add one to the current rider
                        print(isinstance((x.route[i][3]), str))
                        print(x.route)
                        currentRiders+=x.route[i][3]
                else: 
                    currentRiders -= x.route[i][3]    #if the type is end then thats one less rider
                time1=0
                time2=0
                time3=0
                for j in range(i,len(x.route)):  #try all i,j combos (this is kinda slow)
                    #j is the index in the driver queue that you insert the new end point after(could be directly after i)
                    if(j>i):
                        if(x.route[j][2]): 
                            currentRiders+=x.route[j][3]
                        else: 
                            currentRiders -= x.route[j][3]
                    if(currentRiders + len(ride.student_ids)<=3): #make sure there's less than three riders
                        if(j==len(x.route)-1): #if we're inserting it at the end
                            afterDrop = None
                        else:
                            afterDrop = mappings[x.route[j+1][1]]
                        #calculate all the added ride times now
                        time = 0
                        if(i==j):
                            time += dist[str(mappings[x.route[i][1]])][str(mappings[ride.pickup_location])]
                            time += dist[str(mappings[ride.pickup_location])][str(mappings[ride.dropoff_location])]
                            beforeDrop = None
                            if (afterDrop!=None):
                                time-=dist[str(mappings[x.route[i][1]])][str(afterDrop)]
                                time+=dist[str(mappings[ride.dropoff_location])][str(afterDrop)]
                        elif (j==i+1):
                            time1=dist[str(mappings[x.route[i][1]])][str(mappings[ride.pickup_location])]
                            time2=dist[str(mappings[ride.pickup_location])][str(mappings[x.route[i+1][1]])]
                            time3=dist[str(mappings[x.route[i][1]])][str(mappings[x.route[i+1][1]])]
                            time=time+time1+time2-time3
                            beforeDrop = mappings[x.route[j][1]]
                        else:
                            time=time+time1+time2-time3
                            beforeDrop = mappings[x.route[j][1]]
                        if(beforeDrop != None):
                            time += dist[str(beforeDrop)][str(mappings[ride.dropoff_location])]
                            if(afterDrop != None):
                                time -= dist[str(beforeDrop)][str(afterDrop)]
                        #print(time)
                        if(time < minTime): # update if necessary
                            minTime = time
                            driver = x
                            minStart = i
                            minStop = j        
                            minRide = ride
    
    return minTime, driver, minStart, minStop, minRide
